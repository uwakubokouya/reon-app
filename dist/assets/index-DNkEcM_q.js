(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const e of document.querySelectorAll('link[rel="modulepreload"]'))r(e);new MutationObserver(e=>{for(const a of e)if(a.type==="childList")for(const o of a.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&r(o)}).observe(document,{childList:!0,subtree:!0});function t(e){const a={};return e.integrity&&(a.integrity=e.integrity),e.referrerPolicy&&(a.referrerPolicy=e.referrerPolicy),e.crossOrigin==="use-credentials"?a.credentials="include":e.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function r(e){if(e.ep)return;e.ep=!0;const a=t(e);fetch(e.href,a)}})();const{app:c,BrowserWindow:f,ipcMain:d}=require("electron");require("path");const l=require("axios"),p=require("dayjs"),m="https://script.google.com/macros/s/AKfycbzEfLs0FRT0khQEiWaDTA35z6vCeXoSPtOu_R20ywwwldgiyjdNjz_f6qgyPgbF7j80/exec";function h(){const n=new f({width:1e3,height:800,webPreferences:{preload:MAIN_WINDOW_PRELOAD_WEBPACK_ENTRY,contextIsolation:!0,nodeIntegration:!1,webSecurity:!0}});n.webContents.session.webRequest.onHeadersReceived((s,t)=>{t({responseHeaders:{...s.responseHeaders,"Content-Security-Policy":["default-src 'self' 'unsafe-inline' data:;","connect-src 'self' https://zkufbcvorhoyfafukeom.supabase.co https://api.open-meteo.com https://nominatim.openstreetmap.org http://localhost:8000 ws://localhost:3000;","img-src 'self' data:;","style-src 'self' 'unsafe-inline';","script-src 'self' 'unsafe-eval' 'unsafe-inline' data:;"].join(" ")}})}),n.loadURL(MAIN_WINDOW_WEBPACK_ENTRY),n.webContents.openDevTools()}d.handle("check-store-auth",async(n,s,t)=>{const r=`${m}?id=${encodeURIComponent(s)}&pass=${encodeURIComponent(t)}`;try{return(await l.get(r,{headers:{"User-Agent":"Mozilla/5.0"}})).data}catch(e){return{status:"error",message:e.message}}});d.handle("heaven-login",async(n,s,t)=>{try{return(await l.post("http://localhost:8000/api/heaven/login",{heaven_id:s,heaven_pass:t})).data}catch(r){return{ok:!1,message:r?.response?.data?.detail||r?.response?.data?.message||r.message||"認証失敗",raw:r?.response?.data||null}}});d.handle("heaven-diary-count",async(n,s)=>{try{return(await l.get("http://localhost:8000/api/heaven/diary_count",{params:{session_id:s}})).data}catch(t){return{ok:!1,message:t?.response?.data?.detail||t?.response?.data?.message||t.message||"取得失敗",raw:t?.response?.data||null}}});d.handle("heaven-diary-list",async(n,s,t,r)=>{try{let e={diaries:[]},a=p(t),o=p(r);for(let i=a;i.isBefore(o.add(1,"day"));i=i.add(1,"day")){const u=await l.get("http://localhost:8000/api/heaven/diary_list",{params:{session_id:s,date:i.format("YYYY-MM-DD")}});u.data?.diaries?.length&&(e.diaries=e.diaries.concat(u.data.diaries))}return e.ok=!0,e}catch(e){return{diaries:[],ok:!1,message:e?.response?.data?.detail||e?.response?.data?.message||e.message||"取得失敗",raw:e?.response?.data||null}}});c.whenReady().then(h);c.on("window-all-closed",()=>{process.platform!=="darwin"&&c.quit()});c.on("activate",()=>{f.getAllWindows().length===0&&h()});
